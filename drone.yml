kind: pipeline
type: docker
name: build-and-deploy

workspace:
  base: /go
  path: src/github.com/${DRONE_REPO_OWNER}/${DRONE_REPO_NAME}

steps:
- name: deploy-to-s3
  image: plugins/s3
  settings:
    access_key:
      from_secret: AWS_ACCESS_KEY_ID
    secret_key:
      from_secret: AWS_SECRET_ACCESS_KEY

    bucket: bucket-resto-s3
    region: us-east-1 
    
    source: ./* 
    target: /                     
    
    acl: public-read              
    cache_control: max-age=86400   
    overwrite: true               
  
  when:
    branch:
      - main
      - master